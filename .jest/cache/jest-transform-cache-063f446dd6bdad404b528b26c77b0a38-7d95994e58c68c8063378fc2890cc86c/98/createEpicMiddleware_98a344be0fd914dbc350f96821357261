109f986c6fc374c96c77761fa98de450
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createEpicMiddleware = createEpicMiddleware;

var _rxjs = require('rxjs');

var _operators = require('rxjs/operators');

var _ActionsObservable = require('./ActionsObservable');

var _StateObservable = require('./StateObservable');

function createEpicMiddleware() {
  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  if (process.env.NODE_ENV !== 'production' && typeof options === 'function') {
    throw new TypeError('Providing your root Epic to `createEpicMiddleware(rootEpic)` is no longer supported, instead use `epicMiddleware.run(rootEpic)`\n\nLearn more: https://redux-observable.js.org/MIGRATION.html#setting-up-the-middleware');
  }

  var epic$ = new _rxjs.Subject();
  var store = void 0;

  var epicMiddleware = function epicMiddleware(_store) {
    if (process.env.NODE_ENV !== 'production' && store) {
      require('./utils/console').warn('this middleware is already associated with a store. createEpicMiddleware should be called for every store.\n\nLearn more: https://goo.gl/2GQ7Da');
    }

    store = _store;
    var actionSubject$ = new _rxjs.Subject().pipe((0, _operators.observeOn)(_rxjs.queueScheduler));
    var stateSubject$ = new _rxjs.Subject().pipe((0, _operators.observeOn)(_rxjs.queueScheduler));
    var action$ = new _ActionsObservable.ActionsObservable(actionSubject$);
    var state$ = new _StateObservable.StateObservable(stateSubject$, store.getState());
    var result$ = epic$.pipe((0, _operators.map)(function (epic) {
      var output$ = 'dependencies' in options ? epic(action$, state$, options.dependencies) : epic(action$, state$);

      if (!output$) {
        throw new TypeError('Your root Epic "' + (epic.name || '<anonymous>') + '" does not return a stream. Double check you\'re not missing a return statement!');
      }

      return output$;
    }), (0, _operators.mergeMap)(function (output$) {
      return (0, _rxjs.from)(output$).pipe((0, _operators.subscribeOn)(_rxjs.queueScheduler), (0, _operators.observeOn)(_rxjs.queueScheduler));
    }));
    result$.subscribe(store.dispatch);
    return function (next) {
      return function (action) {
        var result = next(action);
        stateSubject$.next(store.getState());
        actionSubject$.next(action);
        return result;
      };
    };
  };

  epicMiddleware.run = function (rootEpic) {
    if (process.env.NODE_ENV !== 'production' && !store) {
      require('./utils/console').warn('epicMiddleware.run(rootEpic) called before the middleware has been setup by redux. Provide the epicMiddleware instance to createStore() first.');
    }

    epic$.next(rootEpic);
  };

  return epicMiddleware;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZUVwaWNNaWRkbGV3YXJlLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY3JlYXRlRXBpY01pZGRsZXdhcmUiLCJfcnhqcyIsInJlcXVpcmUiLCJfb3BlcmF0b3JzIiwiX0FjdGlvbnNPYnNlcnZhYmxlIiwiX1N0YXRlT2JzZXJ2YWJsZSIsIm9wdGlvbnMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJUeXBlRXJyb3IiLCJlcGljJCIsIlN1YmplY3QiLCJzdG9yZSIsImVwaWNNaWRkbGV3YXJlIiwiX3N0b3JlIiwid2FybiIsImFjdGlvblN1YmplY3QkIiwicGlwZSIsIm9ic2VydmVPbiIsInF1ZXVlU2NoZWR1bGVyIiwic3RhdGVTdWJqZWN0JCIsImFjdGlvbiQiLCJBY3Rpb25zT2JzZXJ2YWJsZSIsInN0YXRlJCIsIlN0YXRlT2JzZXJ2YWJsZSIsImdldFN0YXRlIiwicmVzdWx0JCIsIm1hcCIsImVwaWMiLCJvdXRwdXQkIiwiZGVwZW5kZW5jaWVzIiwibmFtZSIsIm1lcmdlTWFwIiwiZnJvbSIsInN1YnNjcmliZU9uIiwic3Vic2NyaWJlIiwiZGlzcGF0Y2giLCJuZXh0IiwiYWN0aW9uIiwicmVzdWx0IiwicnVuIiwicm9vdEVwaWMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxFQUFBQSxLQUFLLEVBQUU7QUFEb0MsQ0FBN0M7QUFHQUQsT0FBTyxDQUFDRSxvQkFBUixHQUErQkEsb0JBQS9COztBQUVBLElBQUlDLEtBQUssR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBbkI7O0FBRUEsSUFBSUMsVUFBVSxHQUFHRCxPQUFPLENBQUMsZ0JBQUQsQ0FBeEI7O0FBRUEsSUFBSUUsa0JBQWtCLEdBQUdGLE9BQU8sQ0FBQyxxQkFB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VixFQUFnQjtBQUNyQixhQUFPLFVBQVVDLE1BQVYsRUFBa0I7QUFJdkIsWUFBSUMsTUFBTSxHQUFHRixJQUFJLENBQUNDLE1BQUQsQ0FBakI7QUFJQWxCLFFBQUFBLGFBQWEsQ0FBQ2lCLElBQWQsQ0FBbUJ6QixLQUFLLENBQUNhLFFBQU4sRUFBbkI7QUFDQVQsUUFBQUEsY0FBYyxDQUFDcUIsSUFBZixDQUFvQkMsTUFBcEI7QUFFQSxlQUFPQyxNQUFQO0FBQ0QsT0FaRDtBQWFELEtBZEQ7QUFlRCxHQXhDRDs7QUEwQ0ExQixFQUFBQSxjQUFjLENBQUMyQixHQUFmLEdBQXFCLFVBQVVDLFFBQVYsRUFBb0I7QUFDdkMsUUFBSW5DLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxRQUFaLEtBQXlCLFlBQXpCLElBQXlDLENBQUNJLEtBQTlDLEVBQXFEO0FBQ25EZCxNQUFBQSxPQUFPLENBQUMsaUJBQUQsQ0FBUCxDQUEyQmlCLElBQTNCLENBQWdDLGdKQUFoQztBQUNEOztBQUNETCxJQUFBQSxLQUFLLENBQUMyQixJQUFOLENBQVdJLFFBQVg7QUFDRCxHQUxEOztBQU9BLFNBQU81QixjQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmNyZWF0ZUVwaWNNaWRkbGV3YXJlID0gY3JlYXRlRXBpY01pZGRsZXdhcmU7XG5cbnZhciBfcnhqcyA9IHJlcXVpcmUoJ3J4anMnKTtcblxudmFyIF9vcGVyYXRvcnMgPSByZXF1aXJlKCdyeGpzL29wZXJhdG9ycycpO1xuXG52YXIgX0FjdGlvbnNPYnNlcnZhYmxlID0gcmVxdWlyZSgnLi9BY3Rpb25zT2JzZXJ2YWJsZScpO1xuXG52YXIgX1N0YXRlT2JzZXJ2YWJsZSA9IHJlcXVpcmUoJy4vU3RhdGVPYnNlcnZhYmxlJyk7XG5cbmZ1bmN0aW9uIGNyZWF0ZUVwaWNNaWRkbGV3YXJlKCkge1xuICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307XG5cbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgdHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdQcm92aWRpbmcgeW91ciByb290IEVwaWMgdG8gYGNyZWF0ZUVwaWNNaWRkbGV3YXJlKHJvb3RFcGljKWAgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCwgaW5zdGVhZCB1c2UgYGVwaWNNaWRkbGV3YXJlLnJ1bihyb290RXBpYylgXFxuXFxuTGVhcm4gbW9yZTogaHR0cHM6Ly9yZWR1eC1vYnNlcnZhYmxlLmpzLm9yZy9NSUdSQVRJT04uaHRtbCNzZXR0aW5nLXVwLXRoZS1taWRkbGV3YXJlJyk7XG4gIH1cblxuICB2YXIgZXBpYyQgPSBuZXcgX3J4anMuU3ViamVjdCgpO1xuICB2YXIgc3RvcmUgPSB2b2lkIDA7XG5cbiAgdmFyIGVwaWNNaWRkbGV3YXJlID0gZnVuY3Rpb24gZXBpY01pZGRsZXdhcmUoX3N0b3JlKSB7XG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgc3RvcmUpIHtcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9yZWR1eC1vYnNlcnZhYmxlL3JlZHV4LW9ic2VydmFibGUvaXNzdWVzLzM4OVxuICAgICAgcmVxdWlyZSgnLi91dGlscy9jb25zb2xlJykud2FybigndGhpcyBtaWRkbGV3YXJlIGlzIGFscmVhZHkgYXNzb2NpYXRlZCB3aXRoIGEgc3RvcmUuIGNyZWF0ZUVwaWNNaWRkbGV3YXJlIHNob3VsZCBiZSBjYWxsZWQgZm9yIGV2ZXJ5IHN0b3JlLlxcblxcbkxlYXJuIG1vcmU6IGh0dHBzOi8vZ29vLmdsLzJHUTdEYScpO1xuICAgIH1cbiAgICBzdG9yZSA9IF9zdG9yZTtcbiAgICB2YXIgYWN0aW9uU3ViamVjdCQgPSBuZXcgX3J4anMuU3ViamVjdCgpLnBpcGUoKDAsIF9vcGVyYXRvcnMub2JzZXJ2ZU9uKShfcnhqcy5xdWV1ZVNjaGVkdWxlcikpO1xuICAgIHZhciBzdGF0ZVN1YmplY3QkID0gbmV3IF9yeGpzLlN1YmplY3QoKS5waXBlKCgwLCBfb3BlcmF0b3JzLm9ic2VydmVPbikoX3J4anMucXVldWVTY2hlZHVsZXIpKTtcbiAgICB2YXIgYWN0aW9uJCA9IG5ldyBfQWN0aW9uc09ic2VydmFibGUuQWN0aW9uc09ic2VydmFibGUoYWN0aW9uU3ViamVjdCQpO1xuICAgIHZhciBzdGF0ZSQgPSBuZXcgX1N0YXRlT2JzZXJ2YWJsZS5TdGF0ZU9ic2VydmFibGUoc3RhdGVTdWJqZWN0JCwgc3RvcmUuZ2V0U3RhdGUoKSk7XG5cbiAgICB2YXIgcmVzdWx0JCA9IGVwaWMkLnBpcGUoKDAsIF9vcGVyYXRvcnMubWFwKShmdW5jdGlvbiAoZXBpYykge1xuICAgICAgdmFyIG91dHB1dCQgPSAnZGVwZW5kZW5jaWVzJyBpbiBvcHRpb25zID8gZXBpYyhhY3Rpb24kLCBzdGF0ZSQsIG9wdGlvbnMuZGVwZW5kZW5jaWVzKSA6IGVwaWMoYWN0aW9uJCwgc3RhdGUkKTtcblxuICAgICAgaWYgKCFvdXRwdXQkKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1lvdXIgcm9vdCBFcGljIFwiJyArIChlcGljLm5hbWUgfHwgJzxhbm9ueW1vdXM+JykgKyAnXCIgZG9lcyBub3QgcmV0dXJuIGEgc3RyZWFtLiBEb3VibGUgY2hlY2sgeW91XFwncmUgbm90IG1pc3NpbmcgYSByZXR1cm4gc3RhdGVtZW50IScpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gb3V0cHV0JDtcbiAgICB9KSwgKDAsIF9vcGVyYXRvcnMubWVyZ2VNYXApKGZ1bmN0aW9uIChvdXRwdXQkKSB7XG4gICAgICByZXR1cm4gKDAsIF9yeGpzLmZyb20pKG91dHB1dCQpLnBpcGUoKDAsIF9vcGVyYXRvcnMuc3Vic2NyaWJlT24pKF9yeGpzLnF1ZXVlU2NoZWR1bGVyKSwgKDAsIF9vcGVyYXRvcnMub2JzZXJ2ZU9uKShfcnhqcy5xdWV1ZVNjaGVkdWxlcikpO1xuICAgIH0pKTtcblxuICAgIHJlc3VsdCQuc3Vic2NyaWJlKHN0b3JlLmRpc3BhdGNoKTtcblxuICAgIHJldHVybiBmdW5jdGlvbiAobmV4dCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhY3Rpb24pIHtcbiAgICAgICAgLy8gRG93bnN0cmVhbSBtaWRkbGV3YXJlIGdldHMgdGhlIGFjdGlvbiBmaXJzdCxcbiAgICAgICAgLy8gd2hpY2ggaW5jbHVkZXMgdGhlaXIgcmVkdWNlcnMsIHNvIHN0YXRlIGlzXG4gICAgICAgIC8vIHVwZGF0ZWQgYmVmb3JlIGVwaWNzIHJlY2VpdmUgdGhlIGFjdGlvblxuICAgICAgICB2YXIgcmVzdWx0ID0gbmV4dChhY3Rpb24pO1xuXG4gICAgICAgIC8vIEl0J3MgaW1wb3J0YW50IHRvIHVwZGF0ZSB0aGUgc3RhdGUkIGJlZm9yZSB3ZSBlbWl0XG4gICAgICAgIC8vIHRoZSBhY3Rpb24gYmVjYXVzZSBvdGhlcndpc2UgaXQgd291bGQgYmUgc3RhbGVcbiAgICAgICAgc3RhdGVTdWJqZWN0JC5uZXh0KHN0b3JlLmdldFN0YXRlKCkpO1xuICAgICAgICBhY3Rpb25TdWJqZWN0JC5uZXh0KGFjdGlvbik7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG4gICAgfTtcbiAgfTtcblxuICBlcGljTWlkZGxld2FyZS5ydW4gPSBmdW5jdGlvbiAocm9vdEVwaWMpIHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhc3RvcmUpIHtcbiAgICAgIHJlcXVpcmUoJy4vdXRpbHMvY29uc29sZScpLndhcm4oJ2VwaWNNaWRkbGV3YXJlLnJ1bihyb290RXBpYykgY2FsbGVkIGJlZm9yZSB0aGUgbWlkZGxld2FyZSBoYXMgYmVlbiBzZXR1cCBieSByZWR1eC4gUHJvdmlkZSB0aGUgZXBpY01pZGRsZXdhcmUgaW5zdGFuY2UgdG8gY3JlYXRlU3RvcmUoKSBmaXJzdC4nKTtcbiAgICB9XG4gICAgZXBpYyQubmV4dChyb290RXBpYyk7XG4gIH07XG5cbiAgcmV0dXJuIGVwaWNNaWRkbGV3YXJlO1xufSJdfQ==